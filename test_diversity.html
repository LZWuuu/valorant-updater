<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diversity Calculation Test</title>
</head>
<body>
    <h1>Team Diversity Calculation Test</h1>
    <div id="test-results"></div>

    <script type="module">
        // Ê®°ÊãüÂõ¢ÈòüÂ§öÊ†∑ÊÄßËÆ°ÁÆóÈÄªËæë
        function calculateDiversity(currentAlphaTeam, currentOmegaTeam, lastRedTeam, lastBlueTeam) {
            const currentAlpha = new Set(currentAlphaTeam);
            const currentOmega = new Set(currentOmegaTeam);
            const lastAlpha = new Set(lastRedTeam);
            const lastOmega = new Set(lastBlueTeam);

            // Ê£ÄÊü•‰∏§ÁßçÂØπÁß∞ÊÉÖÂÜµÔºö
            // ÊÉÖÂÜµ1ÔºöÂΩìÂâçŒ±Èòü = ‰∏äÊ¨°Œ±ÈòüÔºåÂΩìÂâçŒ©Èòü = ‰∏äÊ¨°Œ©Èòü
            const sameAsLastTime =
              currentAlpha.size === lastAlpha.size &&
              [...currentAlpha].every(p => lastAlpha.has(p)) &&
              currentOmega.size === lastOmega.size &&
              [...currentOmega].every(p => lastOmega.has(p));

            // ÊÉÖÂÜµ2ÔºöÂΩìÂâçŒ±Èòü = ‰∏äÊ¨°Œ©ÈòüÔºåÂΩìÂâçŒ©Èòü = ‰∏äÊ¨°Œ±ÈòüÔºàÈòü‰ºçÂØπË∞ÉÔºâ
            const swappedFromLastTime =
              currentAlpha.size === lastOmega.size &&
              [...currentAlpha].every(p => lastOmega.has(p)) &&
              currentOmega.size === lastAlpha.size &&
              [...currentOmega].every(p => lastAlpha.has(p));

            if (sameAsLastTime || swappedFromLastTime) {
              return 0; // ÂÆåÂÖ®Áõ∏ÂêåÁöÑÂàÜÁªÑÔºà‰∏çÁÆ°Èòü‰ºçÂêçÁß∞Ôºâ
            } else {
              // ËÆ°ÁÆóÊúâÂ§öÂ∞ëÁé©ÂÆ∂ÁöÑÈòüÂèãÂèëÁîü‰∫ÜÂèòÂåñ
              let totalChangedPairs = 0;
              const totalPlayers = currentAlpha.size + currentOmega.size;

              // Ê£ÄÊü•ÊØè‰∏™Áé©ÂÆ∂ÁöÑÈòüÂèãÂèòÂåñ
              [...currentAlpha].forEach(player => {
                const currentTeammates = new Set([...currentAlpha].filter(p => p !== player));
                // ÊâæÂà∞ËØ•Áé©ÂÆ∂Âú®‰∏äÊ¨°ÊØîËµõ‰∏≠ÁöÑÈòüÂèã
                let lastTeammates;
                if (lastAlpha.has(player)) {
                  lastTeammates = new Set([...lastAlpha].filter(p => p !== player));
                } else {
                  lastTeammates = new Set([...lastOmega].filter(p => p !== player));
                }

                // ËÆ°ÁÆóÈòüÂèãÂèòÂåñÊï∞Èáè
                const changedTeammates = [...currentTeammates].filter(teammate => !lastTeammates.has(teammate)).length;
                totalChangedPairs += changedTeammates;
              });

              [...currentOmega].forEach(player => {
                const currentTeammates = new Set([...currentOmega].filter(p => p !== player));
                // ÊâæÂà∞ËØ•Áé©ÂÆ∂Âú®‰∏äÊ¨°ÊØîËµõ‰∏≠ÁöÑÈòüÂèã
                let lastTeammates;
                if (lastAlpha.has(player)) {
                  lastTeammates = new Set([...lastAlpha].filter(p => p !== player));
                } else {
                  lastTeammates = new Set([...lastOmega].filter(p => p !== player));
                }

                // ËÆ°ÁÆóÈòüÂèãÂèòÂåñÊï∞Èáè
                const changedTeammates = [...currentTeammates].filter(teammate => !lastTeammates.has(teammate)).length;
                totalChangedPairs += changedTeammates;
              });

              // ÂΩí‰∏ÄÂåñÂà∞ 0-1 ËåÉÂõ¥
              const maxPossibleChanges = totalPlayers * (totalPlayers / 2 - 1);
              return Math.min(totalChangedPairs / maxPossibleChanges, 1);
            }
        }

        // ÊµãËØïÁî®‰æã
        const testCases = [
            {
                name: "Áõ∏ÂêåÂàÜÁªÑ - Áõ¥Êé•ÂåπÈÖç",
                current: { alpha: ["A", "B", "C", "D"], omega: ["E", "F", "G", "H"] },
                last: { red: ["A", "B", "C", "D"], blue: ["E", "F", "G", "H"] },
                expected: 0
            },
            {
                name: "Áõ∏ÂêåÂàÜÁªÑ - Èòü‰ºçÂØπË∞É",
                current: { alpha: ["E", "F", "G", "H"], omega: ["A", "B", "C", "D"] },
                last: { red: ["A", "B", "C", "D"], blue: ["E", "F", "G", "H"] },
                expected: 0
            },
            {
                name: "ÂÆåÂÖ®‰∏çÂêåÂàÜÁªÑ",
                current: { alpha: ["A", "E", "C", "G"], omega: ["B", "F", "D", "H"] },
                last: { red: ["A", "B", "C", "D"], blue: ["E", "F", "G", "H"] },
                expected: "should be > 0"
            },
            {
                name: "ÈÉ®ÂàÜÁõ∏ÂêåÂàÜÁªÑ",
                current: { alpha: ["A", "B", "E", "F"], omega: ["C", "D", "G", "H"] },
                last: { red: ["A", "B", "C", "D"], blue: ["E", "F", "G", "H"] },
                expected: "should be > 0"
            }
        ];

        // ËøêË°åÊµãËØï
        const resultsDiv = document.getElementById('test-results');
        let allTestsPassed = true;

        testCases.forEach((testCase, index) => {
            const result = calculateDiversity(
                testCase.current.alpha,
                testCase.current.omega,
                testCase.last.red,
                testCase.last.blue
            );

            const div = document.createElement('div');
            div.style.margin = '10px 0';
            div.style.padding = '10px';
            div.style.border = '1px solid #ccc';
            div.style.borderRadius = '5px';

            let passed = false;
            if (typeof testCase.expected === 'number') {
                passed = result === testCase.expected;
                div.style.backgroundColor = passed ? '#d4edda' : '#f8d7da';
                div.innerHTML = `
                    <h3>Test ${index + 1}: ${testCase.name}</h3>
                    <p>Current Œ±: [${testCase.current.alpha.join(', ')}]</p>
                    <p>Current Œ©: [${testCase.current.omega.join(', ')}]</p>
                    <p>Last Red: [${testCase.last.red.join(', ')}]</p>
                    <p>Last Blue: [${testCase.last.blue.join(', ')}]</p>
                    <p>Expected: ${testCase.expected}, Got: ${result}</p>
                    <p><strong>${passed ? 'PASSED' : 'FAILED'}</strong></p>
                `;
            } else {
                passed = result > 0;
                div.style.backgroundColor = passed ? '#d4edda' : '#f8d7da';
                div.innerHTML = `
                    <h3>Test ${index + 1}: ${testCase.name}</h3>
                    <p>Current Œ±: [${testCase.current.alpha.join(', ')}]</p>
                    <p>Current Œ©: [${testCase.current.omega.join(', ')}]</p>
                    <p>Last Red: [${testCase.last.red.join(', ')}]</p>
                    <p>Last Blue: [${testCase.last.blue.join(', ')}]</p>
                    <p>Expected: ${testCase.expected}, Got: ${result.toFixed(4)}</p>
                    <p><strong>${passed ? 'PASSED' : 'FAILED'}</strong></p>
                `;
            }

            resultsDiv.appendChild(div);

            if (!passed) {
                allTestsPassed = false;
            }
        });

        // ÊòæÁ§∫ÊÄªÁªì
        const summaryDiv = document.createElement('div');
        summaryDiv.style.margin = '20px 0';
        summaryDiv.style.padding = '15px';
        summaryDiv.style.fontSize = '18px';
        summaryDiv.style.fontWeight = 'bold';
        summaryDiv.style.textAlign = 'center';
        summaryDiv.style.backgroundColor = allTestsPassed ? '#d4edda' : '#f8d7da';
        summaryDiv.style.border = '2px solid ' + (allTestsPassed ? '#c3e6cb' : '#f5c6cb');
        summaryDiv.style.borderRadius = '10px';
        summaryDiv.textContent = allTestsPassed ?
            'üéâ All tests PASSED! Diversity calculation is working correctly.' :
            '‚ùå Some tests FAILED. Check the implementation.';

        resultsDiv.appendChild(summaryDiv);
    </script>
</body>
</html>